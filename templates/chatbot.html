<!-- File: templates/chatbot.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISRO Space Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='chatbot.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>    
    <div class="chat-container">
        <nav class="top-nav">
            <a href="/" class="home-btn">
                <i class="bi bi-arrow-left"></i> Back to Home
            </a>
        </nav>

        <div class="chat-header">
            <div class="header-content">
                <img src="{{ url_for('static', filename='isro_logo.svg') }}" alt="ISRO Logo" class="chat-logo">
                <h1>ISRO Space Assistant</h1>
            </div>
        </div>

        <div class="chat-messages" id="chat-window">
            <!-- Add typing indicator -->
            <div class="typing-indicator" style="display: none;">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            <div class="chat-start">
                <h1>Welcome to ISRO Space Assistant</h1>
                <div class="example-prompts">
                    <div class="prompt-category">
                        <h3>Popular Topics</h3>
                        <div class="prompt-items">
                            <button class="prompt-btn" onclick="submitPrompt('Tell me about ISRO and its main objectives')">
                                <i class="bi bi-rocket-takeoff"></i>
                                <span>About ISRO</span>
                            </button>
                            <button class="prompt-btn" onclick="submitPrompt('What are ISROs major achievements?')">
                                <i class="bi bi-trophy"></i>
                                <span>Major Achievements</span>
                            </button>
                        </div>
                    </div>
                    <div class="prompt-category">
                        <h3>Current Missions</h3>
                        <div class="prompt-items">
                            <button class="prompt-btn" onclick="submitPrompt('Tell me about Chandrayaan-3 mission and its achievements')">
                                <i class="bi bi-moon-stars"></i>
                                <span>Chandrayaan-3 Mission</span>
                            </button>
                            <button class="prompt-btn" onclick="submitPrompt('What is Aditya L1 mission and its objectives?')">
                                <i class="bi bi-sun"></i>
                                <span>Aditya-L1 Solar Mission</span>
                            </button>
                        </div>
                    </div>
                    <div class="prompt-category">
                        <h3>Future Projects</h3>
                        <div class="prompt-items">
                            <button class="prompt-btn" onclick="submitPrompt('Explain the Gaganyaan mission and its current status')">
                                <i class="bi bi-person-workspace"></i>
                                <span>Gaganyaan Human Spaceflight</span>
                            </button>
                            <button class="prompt-btn" onclick="submitPrompt('Tell me about ISROs plans for Venus mission - Shukrayaan')">
                                <i class="bi bi-globe"></i>
                                <span>Shukrayaan Venus Mission</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <form id="chat-form" class="chat-form">
                <div class="input-wrapper">
                    <textarea id="user-input" 
                             placeholder="Ask anything about ISRO and space exploration..."
                             rows="1"
                             class="chat-input"></textarea>
                    <button type="button" class="mic-button" id="mic-btn" title="Click to speak">
                        <i class="bi bi-mic-fill"></i>
                    </button>
                    <button type="submit" class="send-button" id="send-btn">
                        <i class="bi bi-send-fill"></i>
                    </button>
                </div>
                <p class="input-info">Press Enter to send, Shift + Enter for new line</p>
            </form>
        </div>
    </div>
    <div id="chat-box" style="background-color: black; color: white; padding: 20px; height: 400px; overflow-y: auto; border-radius: 10px;"></div>
<form>
  <input type="text" name="message" placeholder="Ask Outreach Bot..." style="width: 80%;">
  <button type="submit">Send</button>
</form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='chatbot.js') }}"></script>
    <script>
document.querySelector("form").addEventListener("submit", function(e) {
    e.preventDefault();
    const input = document.querySelector("input[name='message']");
    const message = input.value;
    input.value = "";

    const chatBox = document.querySelector("#chat-box");
    const userDiv = document.createElement("div");
    userDiv.textContent = "ðŸ§‘ You: " + message;
    chatBox.appendChild(userDiv);

    const botDiv = document.createElement("div");
    botDiv.textContent = "ðŸ¤– Outreach Bot: ";
    chatBox.appendChild(botDiv);

    const eventSource = new EventSourcePolyfill("/stream_response", {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: message })
    });

    eventSource.onmessage = function(event) {
        botDiv.textContent += event.data;
        chatBox.scrollTop = chatBox.scrollHeight;
    };

    eventSource.onerror = function(err) {
        console.error("Error:", err);
        eventSource.close();
    };
});
</script>

<!-- Add this to include polyfill support for POST streaming -->
<script src="https://unpkg.com/event-source-polyfill@1.0.20/eventsource.min.js"></script>

</body>
</html>
